# Complete evaluation configuration
# Run with: prompt-eval run configs/eval_narrative-function-extractor.yml

# https://www.scriptslug.com/

model: claude-opus-4-5-20251101
#model: claude-sonnet-4-20250514
max_tokens: 2048
temperature: 0.1
evaluation_threshold: 0.8

# Reference prompt variants from the prompts/ directory
prompts:
#  - ../prompts/narrative-function-extractor/narrative-function-extractor_v1.yaml
#  - ../prompts/narrative-function-extractor/narrative-function-extractor_v2.yaml
  - ../prompts/narrative-function-extractor/narrative-function-extractor_v3.yaml

# Test cases for evaluation
test_cases:
  - name: Father Frost
    inputs:
      text: |
        A woman has a daughter, whom she loves, and a step-daughter, whom she hates. One day, the woman orders her husband to take her stepdaughter out into the winter wilderness and to leave her there to die, and he obeys, leaving her at the foot of a tree in the forest. Father Frost finds her there, and because the girl is polite and kind to him, he gives her a chest full of beautiful jewels and fine garments. Some time later, the stepmother sends the girl's father to retrieve her body for burial, and is enraged when he instead brings the girl back alive and happy and dressed in finery. Consumed by greed and envy, the woman orders her husband to take her own daughter to the same place, but when found by Father Frost the woman's daughter is rude and unkind to him, and he is inclined to punish rather than reward her. The father finds her frozen to death at the foot of the tree and carries her body back to her grief-stricken mother. 
    expected_contains:
      - "Found: 01. Absentation"
      - "Found: 08. Villainy (or Lack)"
      - "Found: 11. Departure"
      - "Found: 12. First Function of the Donor"
      - "Found: 13. Hero's Reaction"
      - "Found: 14. Receipt of a Magical Agent"
      - "Found: 19. Liquidation"
      - "Found: 20. Return"
      - "Found: 30. The Villain is Punished"
  - name: The White Duck
    inputs:
      text: |
        A king had to leave his newly-wed wife for a journey. He sternly warned her against leaving the women's quarters and listening to bad advice. But an envious wicked witch lured her into the garden and into a pool, and turned her into a white duck, herself taking the queen's own form and place.
        Meanwhile, the white duck built a nest, laid three eggs, and hatched two fluffy ducklings and one little drake. She warned them against the castle, because an evil witch lived there, but one day the witch saw them and lured them inside. The ducklings slept but the drake stayed awake, and when the witch called if they were asleep, the drake answered. But after two answers, the witch went in to see, and saw the ducklings were asleep, so she killed them.
        The white duck found the bodies and lamented over them. The king wondered at it, and although the witch tried to persuade him it was nothing but quacking, he ordered that the duck be captured. His servants could not, but he went himself, and she flew to his hands and became a woman. She told of a bottle in the nest in the garden—or, they sent a magpie for magic water—which, sprinkled on the ducklings and drake, turned them into three lovely children. The witch was then put to death through dismemberment and nothing remained of her. 
    expected_contains:
      - "Found: 01. Absentation"
      - "Found: 02. Interdiction"
      - "Found: 03. Violation of interdiction"
      - "Found: 06. Trickery"
      - "Found: 07. Complicity"
      - "Found: 08. Villainy (or Lack)"
      - "Found: 09. Mediation"
      - "Found: 19. Liquidation"
      - "Found: 27. Recognition"
      - "Found: 28. Exposure"
      - "Found: 29. Transfiguration"
      - "Found: 30. The Villain is Punished"
  - name: Vasilisa the Beautiful
    inputs:
      text: |
        A merchant's wife dies, leaving behind an 8-year-old daughter named Vasilisa. Before her death, the merchant's wife gives Vasilisa a doll with her blessing. This doll is not simple: if it is given something to eat, it can help its owner out of trouble. The merchant eventually remarries to a widow with two daughters the same age as Vasilisa. The new wife dislikes her stepdaughter, giving her various backbreaking jobs, but the doll does all the work for Vasilisa. When Vasilisa grows up, all the suitors in the city begin to woo her. The stepmother refuses everyone, proclaiming that she would not give up her youngest before her elders.
        One day the merchant leaves home for a long time on business, and during this time, at the stepmother's bidding, the family moves to live in another house, standing near a dense forest, where Baba Yaga's hut is located. The stepmother often sends Vasilisa into the forest, hoping that Baba Yaga will devour her, but Vasilisa's doll always guides her to avoid dangerous paths. Finally, the stepmother and her daughters agree to send Vasilisa directly to Baba Yaga's hut for fire, since during the autumn women's work (weaving, knitting and spinning), which is done at night, all fires excluding a single candle are deliberately extinguished. The doll, as usual, promises to take care of Vasilisa's safety, and she sets off on her journey.
        On her way she is passed by three horsemen dressed in white, red and black. On Baba Yaga's fence, made of human bones, skulls are hung, the eye sockets of which illuminate the surroundings with their light like lanterns. Baba Yaga rides out of the forest in her flying mortar and heeds Vasilisa's request. Baba Yaga demands that she, under pain of death, first work as a servant. At Baba Yaga's command, the gates open and then lock themselves. Baba Yaga gives Vasilisa various tasks, but she completes everything on time with the doll's help. The colored horsemen pass by the hut, and Vasilisa discovers Baba Yaga's assistants: three pairs of hands that respond and appear at the call of her voice. Baba Yaga explains that the white, red and black horsemen are respectively Day, Sun and Night, but does not explain what the hands are, warning that she dislikes those who air her personal affairs in public, and that she eats those who are too curious.
        Eventually, Baba Yaga asks Vasilisa how she managed to accomplish her work so well. When Vasilisa responds that she did so by her mother's blessing, Baba Yaga throws her out of her home, rejecting those who are blessed. However, Baba Yaga gifts Vasilisa a skull with burning eyes to use as a lamp. Vasilisa wants to get rid of it, but the skull warns her against this, asking to be taken to her stepmother's house. There, the light coming from the skull's eye sockets incinerates the stepmother and her two daughters. Vasilisa buries the skull and moves to the city, where she settles with an old clothmaker, deciding to take up spinning and weaving while waiting for her father to return. The fabric in Vasilisa's hands is so thin that the clothmaker can carry it straight to the royal palace. The king asks Vasilisa to sew him blouses from this fabric. Appreciating her skillful work and charmed by her beauty, the king takes Vasilisa as his wife. Her father returns from his trading trip and remains to live at court. Vasilisa also brings the clothmaker into court, and carries the doll in her pocket for the rest of her life.
    expected_contains:
      - "Found: 01. Absentation"
      - "Found: 06. Trickery"
      - "Found: 08. Villainy (or Lack)"
      - "Found: 09. Mediation"
      - "Found: 11. Departure"
      - "Found: 12. First Function of the Donor"
      - "Found: 13. Hero's Reaction"
      - "Found: 14. Receipt of a Magical Agent"
      - "Found: 15. Guidance"
      - "Found: 18. Victory"
      - "Found: 19. Liquidation"
      - "Found: 20. Return"
      - "Found: 25. Difficult Task"
      - "Found: 26. Solution"
      - "Found: 27. Recognition"
      - "Found: 30. Punishment"
      - "Found: 31. The Hero is Married and Ascends the Throne"

# Metrics to evaluate
metrics:
  - type: contains
    case_sensitive: false
  
  # Uncomment to add LLM-based evaluation (uses more API calls)
  # - type: llm_judge
  #   criteria: |
  #     Evaluate the summary on:
  #     1. Accuracy - Does it capture the main points?
  #     2. Conciseness - Is it appropriately brief?
  #     3. Clarity - Is it easy to understand?
