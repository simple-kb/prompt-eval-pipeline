# Configuration complète d'évaluation
# Exécuter avec: prompt-eval run configs/fr/eval_narrative-function-extractor.yml

# https://www.scriptslug.com/

model: claude-opus-4-5-20251101
#model: claude-sonnet-4-20250514
max_tokens: 2048
temperature: 0.1
evaluation_threshold: 0.8

# Référencer les variantes de prompts depuis le répertoire prompts/
prompts:
#  - ../../prompts/narrative-function-extractor/fr/narrative-function-extractor_v1.yaml
#  - ../../prompts/narrative-function-extractor/fr/narrative-function-extractor_v2.yaml
#  - ../../prompts/narrative-function-extractor/fr/narrative-function-extractor_v3.yaml
  - ../../prompts/narrative-function-extractor/fr/narrative-function-extractor_v4.yaml

# Cas de test pour l'évaluation
test_cases:
  - name: Les Oies sauvages
    inputs:
      confidence_low: 0.80
      confidence_high: 0.89
      confidence_threshold: 0.85
      text: |
        Des parents villageois qui s'en vont au travail (ou à la foire) confient leur très jeune fils à la garde de leur sœur, une fillette. Celle-ci ne tarde pas à relâcher sa surveillance et des oies sauvages (ou des cygnes) se saisissent du bébé assis sur l'herbe et l'emportent. La fillette part à leur recherche et rencontre successivement en chemin un four à pain, un pommier sauvage et une rivière de lait aux berges de kissel[3]. Chacun d'eux lui propose avant de la guider, qui un petit pain de seigle, qui une pomme aigrelette, qui du kissel arrosé de lait, mais elle dédaigne toutes ces offres. C'est un hérisson (qu'elle a, par prudence, évité de maltraiter) qui l'oriente finalement vers l'endroit où les oies sauvages ont déposé son petit frère : il s'agit de l'isba de Baba Yaga, où l'enfant joue avec des pommes d'or. En cachette, la fillette parvient à saisir son petit frère et à s'enfuir avec lui, mais les oies sauvages la repèrent bientôt et se mettent à tourner, menaçantes, au-dessus d'elle. Elle croise alors à nouveau, dans l'ordre inverse, la rivière, le pommier et le four à pain, desquels elle implore successivement de l'aide pour se cacher. Chacun d'eux le fera, mais seulement après qu'elle aura accepté leur proposition initiale : dans son affolement, elle n'a garde cette fois de jouer la dégoûtée. Ayant échappé aux oies, la fillette rejoint sa maison avec son petit frère au moment même où rentrent ses parents.
    expected_contains:
      - "01, 02, 03, 08, 09, 10, 11, 12, 13, 14, 15, 19, 20, 21, 22"
  - name: Morozko
    inputs:
      confidence_low: 0.80
      confidence_high: 0.89
      confidence_threshold: 0.85
      text: |
        Un couple de vieux a trois filles. La vieille n'aime pas l'aînée, Martha, qui est en réalité sa belle-fille, et elle lui rend la vie pénible. Comme le couple songe à marier ses filles, la vieille cherche à en profiter pour se débarrasser de l'aînée en la mariant au Gel, malgré ses pleurs, en le lui présentant comme un riche et beau parti. Le vieux est contraint d'abandonner sa fille au pied d'un grand pin. Arrive le Gel (Morozko) « sautant de sapin en sapin », qui lui demande à plusieurs reprises si elle a chaud. Bien que glacée, elle affirme que oui et lui répond tendrement. Le Gel s'attendrit, la couvre de fourrures somptueuses et la renvoie chez elle sur un traîneau avec de riches présents. Stupéfaite, la vieille décide d'envoyer à leur tour ses deux filles se fiancer à Morozko pour qu'il les comble de cadeaux. Laissées au pied du pin, celles-ci maudissent le froid et leur promis qui ne vient pas. Arrive le Gel qui leur demande si elles ont chaud, mais elles l'envoient à tous les diables, et meurent pétrifiées de froid. Le lendemain, le vieux ramène à la vieille ses deux filles mortes. La vieille entre en rage, mais est contrainte de faire la paix avec sa belle-fille, qui épousera finalement un voisin.
    expected_contains:
      - "01, 06, 08, 09, 11, 12, 13, 14, 19, 20, 30, 31"
  - name: Vassilissa-la-très-belle
    inputs:
      confidence_low: 0.80
      confidence_high: 0.89
      confidence_threshold: 0.85
      text: |
        Vassilissa est la fille unique d'un marchand veuf. Avant de mourir, sa mère lui a confié une poupée en lui recommandant de la garder précieusement avec elle, de ne la montrer à personne et de lui donner à manger lorsqu'elle-même aura besoin d'aide. Le marchand se remarie avec une veuve qui a déjà deux filles, lesquelles se mettent à jalouser et à tourmenter Vassilissa. Celle-ci, en cachette, raconte ses malheurs à la poupée, qui la conseille et l'aide en réalisant les travaux pénibles à sa place. Un jour, alors que le marchand est parti pour un long voyage, la marâtre envoie Vassilissa chez la sorcière cannibale Baba Yaga sous le prétexte de lui demander du feu, que ses filles ont laissé s'éteindre. La poupée la réconforte et lui recommande de l'emporter avec elle. Chemin faisant, Vassilissa rencontre successivement trois cavaliers, l'un tout blanc à l'aube, le second tout rouge à l'aurore ; elle croise le troisième, tout noir, alors qu'elle est parvenue à la clairière où se dresse la hutte de Baba Yaga et que la nuit tombe. L'endroit est particulièrement sinistre, la maison étant faite d'ossements, ornée de crânes portant des yeux brillant dans la nuit, et le cadenas étant figuré par une bouche prête à mordre. Arrive, voyageant dans les airs dans son mortier, la Baba Yaga, qui déclare sentir une odeur de chair humaine. Tremblante, Vassilissa se découvre et explique le motif de sa visite. Baba Yaga, qui indique au passage connaître les filles de la marâtre, la prend alors à son service, et lui ordonne d'abord de lui servir tout ce qui peut se manger et se boire dans la maison : elle dévore tout, ne laissant que quelques restes à la jeune fille. Avant de se coucher, elle lui annonce que le lendemain, en son absence, elle devra tout ranger, nettoyer, et trier un boisseau de blé grain par grain. La poupée, à qui Vassilissa a donné les restes et raconté sa peine, la réconforte, l'assurant que tout ira bien. Le lendemain, le travail se fait en effet tout seul, grâce à la poupée. A la nuit tombée, Baba Yaga est de retour et ne voit rien à redire. Elle appelle alors ses serviteurs pour moudre le blé, et trois paires de bras apparaissent et emportent le grain. Avant de se coucher, elle annonce à Vassilissa que le lendemain, en plus du travail effectué ce jour-là, elle devra trier un boisseau de graines de pavot, sans quoi elle sera dévorée. Encore une fois, la poupée lui conseille de prier et d'aller dormir tranquillement, demain étant un autre jour. Tout se passe de la même façon que la veille, et les trois paires de bras emportent les graines de pavot pour en extraire l'huile. Vassilissa s'enhardit à demander à la sorcière qui sont les trois cavaliers, et celle-ci lui répond qu'il s'agit de son jour clair, de son soleil ardent et de sa sombre nuit. La jeune fille s'abstient cependant prudemment d'en demander davantage à propos des trois paires de bras, et Baba Yaga l'approuve de ne poser des questions que sur ce qui se passe à l'extérieur, et non à l'intérieur. Toutefois, lorsque Vassilissa lui avoue qu'elle est aidée dans ses tâches par la bénédiction maternelle, la sorcière, irritée, la jette dehors, ne voulant « pas de bénis chez elle », mais non sans lui donner malgré tout un crâne aux yeux ardents planté sur un bâton, puisque les filles de la marâtre réclamaient du feu. Les yeux du crâne éclairent le chemin à travers la forêt que Vassilissa retraverse de nuit ; elle chemine encore un jour, puis veut jeter le crâne, pensant que les deux filles auront trouvé du feu entretemps, mais le crâne lui-même lui ordonne de n'en rien faire et de le porter jusque chez la marâtre. Lorsqu'elle arrive à la maison, plongée dans le noir, les yeux du crâne se fixent sur la marâtre et ses filles, les poursuivant partout et finissant par les consumer. Vassilissa enterre le crâne, ferme la maison et s'en va à la ville, où une vieille femme la recueille en attendant le retour de son père. La jeune fille, toujours aidée par sa poupée, se met à tisser une toile de lin extraordinairement légère et solide, et propose à la vieille d'aller la vendre au marché, mais celle-ci est d'avis qu'une telle toile ne peut qu'être offerte au tsar, ce qu'elle fait, recevant des cadeaux en échange. Le tsar veut faire couper des chemises dans la toile, mais aucun tailleur n'y parvient. Il envoie alors chercher la vieille, qui l'informe que c'est sa fille adoptive qui a tissé la toile. Le tsar ordonne que celle-ci couse elle-même les chemises. Vassilissa s'exécute, et se rend au palais pour livrer son travail, soigneusement vêtue et apprêtée : le tsar tombe immédiatement amoureux d'elle et l'épouse. Le père de Vassilissa revient de voyage, découvre le bonheur de sa fille et reste vivre auprès d'elle, ainsi que la vieille. Vassilissa, devenue tsarine, gardera toute sa vie sa poupée sur elle, dans sa poche. 
    expected_contains:
      - "01, 02, 0-, 07, 08, 09, 11, 12, 13, 14, 19, 20, 25, 26, 27, 30, 31"

# Métriques à évaluer
metrics:
  - type: contains
    case_sensitive: false

  # Décommenter pour ajouter une évaluation basée sur LLM (utilise plus d'appels API)
  # - type: llm_judge
  #   criteria: |
  #     Évaluer le résumé sur:
  #     1. Exactitude - Capture-t-il les points principaux?
  #     2. Concision - Est-il suffisamment bref?
  #     3. Clarté - Est-il facile à comprendre?
